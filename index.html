<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Hit & Blow</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<!-- PWAè¨­å®š -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6c5ce7">

<style>
/* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« --- */
body { font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background:#f1f2f6; margin:0; padding:0; color:#222; }
.container { max-width:480px; margin:5px auto; background:white; padding:16px; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.08); }
h2 { display:flex; justify-content:space-between; align-items:center; font-size:20px; margin:0 0 10px 0; }
.stats { display:flex; flex-wrap:wrap; justify-content:space-between; margin-bottom:8px; font-size:14px; }
.mode-buttons { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; margin-bottom:8px; }
.mode-buttons button { padding:10px; border-radius:12px; border:none; font-size:14px; }
.mode-buttons .active { background:#00b894; color:white; }
input { width:100%; font-size:28px; padding:12px; text-align:center; border-radius:10px; border:1px solid #bbb; box-sizing:border-box; background:white; color:#222; }
.top-buttons { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px; }
button { padding:12px; border-radius:12px; border:none; color:white; font-size:17px; cursor:pointer; }
.newgame { background:#6c5ce7; }
.ok-btn { background:#00b894; }
.keypad { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; margin-top:10px; }
.keypad button { font-size:24px; padding:16px; border-radius:12px; background:#636e72; color:white; }
.delete-btn { background:#d63031; }
.sub-buttons { display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:8px; }
.sub-buttons button { background:#0984e3; color:white; font-size:16px; }
table { width:100%; border-collapse:collapse; margin-top:10px; table-layout:fixed; }
th, td { border:1px solid #ccc; text-align:center; padding:6px; font-size:14px; }
.cell {
  display:flex;
  justify-content:center;
  align-items:center;
  height:28px;
  line-height:28px;
  margin:0 2px;
  border:1px solid #ccc;
  border-radius:6px;
  font-weight:bold;
  white-space:nowrap;
  text-align:center;
  flex:1;       /* æ¨ªå¹…ã‚’å‡ç­‰ã«å‰²ã‚Šå½“ã¦ */
  min-width:28px;
}
.answer-cell { background:#ff7675; color:white; }
.blue { background:#74b9ff; }

/* H/Bã‚»ãƒ«å›ºå®šå¹… */
th:nth-child(2), th:nth-child(3),
td:nth-child(2), td:nth-child(3) { width:30px; }

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
body.dark { background:#121212; color:#f0f0f0; }
body.dark .container { background:#1f1f1f; }
body.dark input { background:#2b2b2b; color:#f0f0f0; border-color:#555; }
body.dark table, body.dark th, body.dark td { border-color:#555; }
body.dark .keypad button { background:#444; color:#f0f0f0; }
body.dark .delete-btn { background:#e17055; }
body.dark .sub-buttons button, body.dark .top-buttons button { color:white; }
body.dark .mode-buttons button { background:#333; color:#f0f0f0; }
body.dark .mode-buttons .active { background:#00b894; color:white; }
</style>
</head>
<body>

<div class="container">
  <h2>
    Hit & Blow
    <button id="darkToggle" onclick="toggleDarkMode()" style="font-size:18px;background:#636e72;border:none;border-radius:8px;padding:4px 8px;color:white;cursor:pointer;">ğŸŒ™</button>
  </h2>

  <div class="stats">
    <div>ğŸ® ãƒ—ãƒ¬ã‚¤å›æ•°ï¼š<span id="playCount">0</span></div>
    <div>ğŸ† æˆåŠŸå›æ•°ï¼š<span id="winCount">0</span></div>
    <div>ğŸ“ æ‰‹æ•°ï¼š<span id="turnCount">0</span></div>
  </div>

  <div class="mode-buttons">
    <button id="mode3" onclick="setDigit(3)">3æ¡</button>
    <button id="mode4" onclick="setDigit(4)" class="active">4æ¡</button>
    <button id="mode5" onclick="setDigit(5)">5æ¡</button>
  </div>

  <input id="guess" placeholder="å…¥åŠ›" readonly type="tel">

  <div class="top-buttons">
    <button class="newgame" onclick="resetGame()">ãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ </button>
    <button class="ok-btn" onclick="check()">åˆ¤å®š</button>
  </div>

  <div class="keypad">
    <button onclick="press(1)">1</button>
    <button onclick="press(2)">2</button>
    <button onclick="press(3)">3</button>
    <button onclick="press(4)">4</button>
    <button onclick="press(5)">5</button>
    <button onclick="press(6)">6</button>
    <button onclick="press(7)">7</button>
    <button onclick="press(8)">8</button>
    <button onclick="press(9)">9</button>
    <button class="delete-btn" onclick="del()">å‰Šé™¤</button>
  </div>

  <div class="sub-buttons">
    <button onclick="showHint()">ãƒ’ãƒ³ãƒˆ</button>
    <button onclick="giveUp()">ã‚®ãƒ–ã‚¢ãƒƒãƒ—</button>
  </div>

  <table>
    <thead>
      <tr><th>å…¥åŠ›</th><th>H</th><th>B</th></tr>
    </thead>
    <tbody id="history"></tbody>
  </table>
</div>

<!-- åŠ¹æœéŸ³ -->
<audio id="seTap" src="https://assets.mixkit.co/active_storage/sfx/2001/2001-preview.mp3"></audio>
<audio id="seCorrect" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
<audio id="seWrong" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>

<script>
let answer=[],digit=4,gameOver=false,turnCount=0,hintUsed=false;

// --- æ¡æ•°ã”ã¨ã®è¨˜éŒ² ---
function loadStats(){ return { play:Number(localStorage.getItem(`hb_play_${digit}`)||0), win:Number(localStorage.getItem(`hb_win_${digit}`)||0) }; }
function saveStats(play,win){ localStorage.setItem(`hb_play_${digit}`,play); localStorage.setItem(`hb_win_${digit}`,win); }
let stats=loadStats();
document.getElementById("playCount").textContent=stats.play;
document.getElementById("winCount").textContent=stats.win;
document.getElementById("turnCount").textContent=turnCount;

startGame();

// --- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ ---
function toggleDarkMode(){
  const btn = document.getElementById("darkToggle");
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  btn.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
  localStorage.setItem("darkMode", isDark ? "1" : "0");
}
const btn = document.getElementById("darkToggle");
if(localStorage.getItem("darkMode")==="1"){ document.body.classList.add("dark"); btn.textContent = "â˜€ï¸"; }

// --- æ¡æ•°åˆ‡æ›¿ ---
function setDigit(n){
  digit=n;
  document.querySelectorAll(".mode-buttons button").forEach(b=>b.classList.remove("active"));
  document.getElementById("mode"+n).classList.add("active");
  stats=loadStats();
  document.getElementById("playCount").textContent=stats.play;
  document.getElementById("winCount").textContent=stats.win;
  startGame();
}

// --- ã‚²ãƒ¼ãƒ å‡¦ç† ---
function generateAnswer(){ const nums=[]; while(nums.length<digit){ const n=Math.floor(Math.random()*9)+1; if(!nums.includes(n)) nums.push(n); } return nums; }

function startGame(){ 
  answer=generateAnswer(); 
  document.getElementById("history").innerHTML=""; 
  document.getElementById("guess").value=""; 
  turnCount=0; hintUsed=false; gameOver=false; 
  document.getElementById("turnCount").textContent=turnCount; 
  console.log("ç­”ãˆ:",answer.join(""));
}

function resetGame(){ 
  if(!confirm("æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ")) return; 
  stats.play++; saveStats(stats.play,stats.win); 
  document.getElementById("playCount").textContent=stats.play; 
  startGame(); 
}

function playSE(id){ const se=document.getElementById(id); se.currentTime=0; se.play(); }

function press(n){ 
  if(gameOver) return; 
  const input=document.getElementById("guess"); 
  if(input.value.length>=digit) return; 
  if(input.value.includes(n)) return; 
  input.value+=n; 
  if(navigator.vibrate) navigator.vibrate(20); 
  playSE("seTap"); 
}

function del(){ 
  if(gameOver) return; 
  const input=document.getElementById("guess"); 
  input.value=input.value.slice(0,-1); 
  if(navigator.vibrate) navigator.vibrate(15); 
}

function check(){
  if(gameOver) return;
  const input=document.getElementById("guess").value;
  if(input.length!==digit){ alert(digit+"æ¡å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆé‡è¤‡ä¸å¯ï¼‰"); playSE("seWrong"); return; }
  const guess=input.split("").map(Number); 
  let hit=0,ball=0;
  guess.forEach((n,i)=>{ if(n===answer[i]) hit++; else if(answer.includes(n)) ball++; });
  const cells=guess.map(n=>`<span class="cell">${n}</span>`).join("");
  document.getElementById("history").innerHTML+=`<tr><td>${cells}</td><td>${hit}</td><td>${ball}</td></tr>`;
  document.getElementById("guess").value="";
  turnCount++; 
  document.getElementById("turnCount").textContent=turnCount;
  if(hit===digit){ 
    playSE("seCorrect"); 
    if(navigator.vibrate) navigator.vibrate([60,40,60]); 
    if(!hintUsed){ stats.win++; saveStats(stats.play,stats.win); document.getElementById("winCount").textContent=stats.win; alert("ğŸ‰ æ­£è§£ï¼ãŠã‚ã§ã¨ã†ï¼"); } 
    else alert("ãƒ’ãƒ³ãƒˆä½¿ç”¨æ¸ˆã¿ãªã®ã§æˆåŠŸå›æ•°ã«ã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã›ã‚“ã€‚æ­£è§£ï¼"); 
    gameOver=true; 
  } else playSE("seWrong");
}

function showHint(){ 
  if(gameOver) return; 
  if(!confirm("ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã‹ï¼Ÿ")) return; 
  hintUsed=true; 
  const cells=document.querySelectorAll(".cell"); 
  cells.forEach(cell=>cell.classList.remove("blue")); 
  cells.forEach(cell=>{ const num=Number(cell.textContent); if(answer.includes(num)) cell.classList.add("blue"); }); 
}

function giveUp(){ 
  if(gameOver) return; 
  if(!confirm("æœ¬å½“ã«ã‚®ãƒ–ã‚¢ãƒƒãƒ—ã—ã¾ã™ã‹ï¼Ÿ")) return; 
  const history=document.getElementById("history"); 
  const answerCells=answer.map(n=>`<span class="cell answer-cell">${n}</span>`).join(''); 
  history.innerHTML+=`<tr><td>${answerCells}</td><td>-</td><td>-</td></tr>`; 
  alert("ç­”ãˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸã€‚å±¥æ­´ã‚’è¦‹ã¦æŒ¯ã‚Šè¿”ã£ã¦ãã ã•ã„ã€‚\nãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ ã¯å³ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰é–‹å§‹ã§ãã¾ã™ã€‚"); 
  gameOver=true; 
}

// --- Service Worker ç™»éŒ²ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰ ---
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
  .then(reg=>console.log('Service Worker ç™»éŒ²æˆåŠŸ',reg))
  .catch(err=>console.log('Service Worker ç™»éŒ²å¤±æ•—',err));
}
</script>
</body>
</html>
